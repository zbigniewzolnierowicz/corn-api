[tox]
isolated_build = true
env_list =
    type
    lint
    clean
    unit
    report

[testenv:unit]
setenv =
    ENV=test
deps =
    pytest
    pytest-cov
    pytest-asyncio
    pytest-xdist
    httpx
depends =
    unit: clean
commands =
    pytest --import-mode=importlib --cov {envsitepackagesdir}/corn --cov-append --cov-report=term-missing -n=auto

[testenv:clean]
deps = coverage
skip_install = true
commands = coverage erase

[testenv:report]
deps = coverage
skip_install = true
depends =
    report: unit
commands =
    coverage report

[testenv:type]
deps =
    mypy
commands =
    mypy corn

[testenv:lint]
deps =
    ruff
commands =
    ruff .
